---
description: 根据交互式或提供的原则输入创建或更新项目章程，确保所有相关的模板保持同步。
handoffs:
   - label: 构建规格
     agent: speckit.specify
     prompt: 基于更新后的章程实施功能规格说明。我想构建...
---
## 用户输入

```text
$ARGUMENTS
```
在继续之前，您**必须**考虑用户输入（如果不为空）。

--- 
## 1.1 开始 `RESUME` 检查
- **在开始设置前，通过状态文件确定项目的状态。**

1.  **读取状态文件：**检查 `conductor/setup_state.json` 是否存在。
    - 若不存在，则为新项目设置。直接跳转至步骤 1.2。
    - 若存在，则读取其内容。

2.  **基于状态的恢复：**
    - 令JSON文件中`last_successful_step`的值为`step`。
    - 根据`step`的值跳转至**下一逻辑章节**：

    - 若`step`为“2.1_product_guide”，则提示“恢复设置：产品指南（`product.md`）已完成。接下来我们将创建产品规范。”并转至**第2.2节**。
    - 若`step`为“2.2_product_guidelines”，则提示“恢复设置：产品指南与规范已完成。接下来将定义技术栈”，并进入**第2.3节**。
    - 若`step` 为 “2.3_tech_stack”，则提示：“恢复设置：产品指南、规范及技术栈已定义。接下来将选择代码风格指南。” 并进入 **第 2.4 节**。
    - 若`step` 为 “2.4_code_styleguides”，则提示："恢复设置： 所有指南与技术栈已配置完毕。接下来将定义项目工作流。"并跳转至**第2.5节**。
    - 若`step`为“2.5_workflow”，则提示：“恢复设置：初始项目框架已完成。接下来将生成首个任务轨迹。”并跳转至**第二阶段(3.0)**。
    - 若 `step` 为 “3.3_initial_track_generated”：
        - 提示：“项目已初始化。可通过 `/conductor:newTrack` 创建新轨道，或使用 `/conductor:implement` 开始实现现有轨道。”
        - 终止 `setup` 流程。
    - 若 `step` 参数无效，则提示错误并终止。


---

## 1.2 初始化前概述
1.  **提供高层次概述：**
    -   向用户展示初始化流程概述：
        > 欢迎使用Conductor。我将引导您完成以下项目设置步骤：
        > 1. **项目识别:** 分析当前目录以判断是新建项目还是现有项目。
        > 2. **产品定义:** 协作定义产品愿景、设计规范及技术栈。
        > 3. **配置阶段:** 选择适用的代码规范指南并定制开发工作流。
        > 4. **任务生成:** 定义初始 **任务**（如功能开发或缺陷修复等高阶工作单元），并自动生成详细开发计划。
        >
        > 让我们开始吧！"

---

## 2.0 第一阶段：简化项目设置
**操作流程：遵循此步骤顺序，引导用户完成交互式设置。**

### 2.0 项目启动
1.  **检测项目成熟度:**
    -   **项目分类:** 根据以下指标判断项目属于“棕地项目”（现有项目）或“绿地项目”（新项目）:
    -   **现有项目指标:**
        -   检查是否存在版本控制目录：`.git`、`.svn` 或 `.hg`。
        -   若存在`.git`目录，执行`git status --porcelain`。若输出非空，则归类为“棕地”（现有项目）。
        -   检查依赖清单文件：`package.json`、`pom.xml`、`requirements.txt`、`go.mod`、`composer.json`。
        -   检查源代码目录：`src/`、`app/`、`lib/` 是否包含代码文件。
        -   若满足任意上述条件（版本控制目录、Git仓库、依赖清单或源代码目录），则归类为**现有项目**。
    -   **新项目:**
        -   仅当未发现任何“现有项目指标”且当前目录为空或仅包含通用文档（例如单个`README.md`文件），且不含功能性代码或依赖项时，方可归类为**新项目**


2.  **根据成熟度执行工作流:**
   -   **若为现有项目:**
       -   通知检测到现有项目.
       -   若`git status --porcelain`命令（作为存量项目指标执行）显示存在未提交的变更，则告知用户："警告： 您的Git仓库存在未提交修改。请在继续前提交或暂存修改，因Conductor将进行修改操作。"
       -    **启动存量项目初始化协议：**
    
       -   **1.0 预分析确认：**
           1. **请求授权：** 告知用户已检测到存量（现有）项目。
           2. **征求许可：** 请求进行只读扫描以分析项目，提供以下选项并采用如下结构：
                > A) Yes  
                  B) No
                > 
                > 请回复 A 或 B。 
           3. **处理拒绝：** 若许可被拒绝，终止流程并等待用户进一步指示。
           4. **确认操作：** 获得确认后进入下一步。

       -   **2.0 代码分析：**
           1.  **操作提示：** 告知用户即将执行代码分析。
           2.  **优先处理README：** 若存在`README.md`文件，优先进行分析。
           3.  **全面扫描：** 扩展分析范围至其他相关文件以全面理解
    
       -   **2.1 文件大小与相关性筛选：**
           1.  **尊重忽略文件：** 在扫描任何文件前，必须检查是否存在 `.geminiignore` 和 `.gitignore` 文件。若存在其中任一或两者，必须使用其组合模式将文件和目录排除在分析之外。若两者存在冲突，`.geminiignore`中的模式应优先于`.gitignore`。这是规避`node_modules`等冗余无关文件的核心机制。
           2.  **高效列举相关文件：** 列举待分析文件时，必须使用遵循忽略规则的命令。例如可使用 `git ls-files --exclude-standard -co | xargs -n 1 dirname | sort -u`，该命令能列出所有相关目录（Git 追踪目录及未忽略的其他文件），而无需逐个列出文件。若未使用 Git，则必须构建能读取忽略文件并剔除对应路径的 `find` 命令。
           3.  **手动忽略方案：** 仅当同时不存在 `.geminiignore` 和 `.gitignore` 时，才应手动忽略常见目录。示例命令：`ls -lR -I ‘node_modules’ -I ‘.m2’ -I ‘build’ -I ‘dist’ -I ‘bin’ -I ‘target’ -I ‘.git’ -I ‘.idea’ -I ‘.vscode’`。

       -   **2.2 提取并推断项目背景：**
           1.  **严格文件访问：** 切勿索取更多文件。分析仅基于提供的文件片段和目录结构。
           2.  **提取技术栈：** 分析清单文件内容以识别：
               -   编程语言
               -   框架（前端与后端）
               -   数据库驱动程序
           3.  **推断架构类型：** 根据文件树骨架（前两层）推断架构类型（如单仓库、微服务、MVC）。
           4.  **推断项目目标：** 严格依据提供的`README.md`标题或`package.json`描述，用一句话概括项目目标。
       -   **完成现有项目初始化后，请转至2.1节中的生成产品指南部分。**
   -   **若为新项目：**
       -   宣布将启动新项目。
       -   继续执行本文件中的下一步操作。

